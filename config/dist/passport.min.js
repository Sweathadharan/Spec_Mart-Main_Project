"use strict";var LocalStrategy=require("passport-local").Strategy,bcrypt=require("bcrypt-nodejs"),database=require("../config/database"),RunQuery=database.RunQuery;module.exports=function(e){e.serializeUser(function(e,r){r(null,e.UserID)}),e.deserializeUser(function(e,r){RunQuery("            SELECT *            FROM users            where UserID = '"+e+"'",function(e){r(null,e[0])})}),e.use("sign-in",new LocalStrategy({usernameField:"username",passwordField:"password",passReqToCallback:!0},function(r,e,s,n){RunQuery("SELECT * FROM users WHERE Username = '"+e+"'",function(e){return e.length<1?n(null,!1,r.flash("signInError","No user found.")):bcrypt.compareSync(s,e[0].Password)?n(null,e[0]):n(null,!1,r.flash("signInError","Oops! Wrong password."))})})),e.use("sign-up",new LocalStrategy({usernameField:"username",passwordField:"password",passReqToCallback:!0},function(d,i,c,y){var E=d.body.email;if(c!=d.body.rePassword)return y(null,!1,d.flash("signUpError","Passwords do not match."));var r="SELECT *                    FROM users                    WHERE email = '"+E+"'";RunQuery(r,function(e){if(0<e.length)return y(null,!1,d.flash("signUpError","Email address has already been used."));RunQuery(r="                        SELECT *                        FROM users                        WHERE username = '"+i+"'",function(e){if(0<e.length)return y(null,!1,d.flash("signUpError","Username has already been used."));var s=d.body.fullName,n=d.body.phone,u=d.body.streetAddress,a=d.body.postcode,l=d.body.city,o=d.body.country,r=bcrypt.hashSync(c,null,null),t="INSERT INTO Users                                    VALUES(null,                                    '"+s+"',                                     '"+u+"',                                     '"+a+"',                                     '"+l+"',                                     '"+o+"',                                     '"+n+"',                                     '"+E+"',                                     '"+i+"',                                     '"+r+"', 0)";RunQuery(t,function(e){var r={UserID:e.insertId};t="INSERT INTO Addresses                                    VALUES(null, "+e.insertId+", '"+s+"', '"+u+"', '"+a+"', '"+l+"', '"+o+"', '"+n+"')",RunQuery(t,function(e){return y(null,r)})})})})}))};
//# sourceMappingURL=passport.min.js.map
