"use strict";var express=require("express"),router=express.Router(),bcrypt=require("bcrypt-nodejs"),database=require("../config/database"),RunQuery=database.RunQuery;function isLoggedIn(e,r,s){if(e.isAuthenticated())return s();r.redirect("/")}router.route("/").get(function(e,r){e.isAuthenticated()&&(1==e.user.Admin?r.redirect("/admin"):r.redirect("/usr/"+e.user.Username)),r.redirect("/")}),router.route("/:username").get(isLoggedIn,function(e,r){r.render("profile/profile",{title:e.user.FullName,customer:e.user})}),router.route("/:username/edit").get(isLoggedIn,function(e,r){r.render("profile/editProfile",{title:e.user.FullName,customer:e.user})}).post(isLoggedIn,function(r,s){var e=r.body;if(bcrypt.compareSync(e.password,r.user.Password)){var u="                UPDATE Users                SET Fullname = '"+e.fullName+"',                     Email = '"+e.email+"',                     StreetAddress = '"+e.streetAddress+"',                     PostCode = '"+e.postcode+"',                     City = '"+e.city+"',                     Country = '"+e.country+"',                     Phone = '"+e.phone+"'                 WHERE UserID = "+r.user.UserID;RunQuery(u,function(e){s.redirect("/usr/"+r.user.Username)})}}),router.route("/:username/change-password").get(isLoggedIn,function(e,r){r.render("profile/changePassword",{title:e.user.FullName,customer:e.user})}).post(isLoggedIn,function(r,s){var e=r.body;if(e.newPassword==e.repeatPassword&&bcrypt.compareSync(e.currentPassword,r.user.Password)){var u="                UPDATE Users                SET Password = '"+bcrypt.hashSync(e.newPassword,null,null)+"'                 WHERE UserID = "+r.user.UserID;RunQuery(u,function(e){s.redirect("/usr/"+r.user.Username)})}}),router.route("/:username/orders").get(isLoggedIn,function(r,s){var e="            SELECT *            FROM Orders            WHERE UserID = "+r.user.UserID;RunQuery(e,function(e){s.render("profile/orders",{title:r.user.FullName,customer:r.user,orders:e})})}),router.route("/:username/orders/ll").get(isLoggedIn,function(e,r){r.render("profile/pay")}),router.route("/eye-test/eye").get(isLoggedIn,function(e,r){r.render("views/eye/")}),router.route("/:username/orders/:id").get(isLoggedIn,function(t,d){var e="            SELECT *            FROM Orders            WHERE OrderID = "+t.params.id;RunQuery(e,function(u){e="                SELECT *                FROM Addresses                WHERE AddressID = "+u[0].AddressID,RunQuery(e,function(s){e="                    SELECT *                    FROM `Order Details`                    INNER JOIN (                        SELECT Products.*, Categories.CategorySlug                        FROM Products                        INNER JOIN Categories                        ON Products.CategoryID = Categories.CategoryID                    ) `Table`                    ON `Order Details`.ProductID = `Table`.ProductID                    WHERE OrderID = "+u[0].OrderID,RunQuery(e,function(e){var r={title:t.user.FullName,customer:t.user,order:u[0],address:s[0],products:e};d.render("profile/viewOrder",r)})})})}),router.route("/:username/orders/:id").get(isLoggedIn,function(t,d){var e="            SELECT *            FROM Orders            WHERE OrderID = "+t.params.id;RunQuery(e,function(u){e="                SELECT *                FROM Addresses                WHERE AddressID = "+u[0].AddressID,RunQuery(e,function(s){e="                    SELECT *                    FROM `Order Details`                    INNER JOIN (                        SELECT Products.*, Categories.CategorySlug                        FROM Products                        INNER JOIN Categories                        ON Products.CategoryID = Categories.CategoryID                    ) `Table`                    ON `Order Details`.ProductID = `Table`.ProductID                    WHERE OrderID = "+u[0].OrderID,RunQuery(e,function(e){var r={title:t.user.FullName,customer:t.user,order:u[0],address:s[0],products:e};d.render("profile/viewOrder",r)})})})}),router.route("/:username/addresses").get(isLoggedIn,function(r,s){var e="            SELECT *            FROM Addresses            WHERE UserID = "+r.user.UserID;RunQuery(e,function(e){s.render("profile/addresses",{title:r.user.FullName,customer:r.user,addresses:e})})}),router.route("/:username/addresses/:id/edit").get(isLoggedIn,function(r,s){var e="            SELECT *            FROM Addresses            WHERE AddressID = "+r.params.id;RunQuery(e,function(e){s.render("profile/editAddress",{title:r.user.FullName,customer:r.user,address:e[0]})})}).post(isLoggedIn,function(r,s){var e=r.body,u="                UPDATE Addresses                SET Fullname = '"+e.fullName+"',                     StreetAddress = '"+e.streetAddress+"',                     PostCode = '"+e.postcode+"',                     City = '"+e.city+"',                     Country = '"+e.country+"',                     Phone = '"+e.phone+"'                 WHERE AddressID = "+r.params.id;RunQuery(u,function(e){s.redirect("/usr/"+r.user.Username+"/addresses/")})}),router.route("/:username/addresses/:id/delete").post(isLoggedIn,function(r,s,e){var u="            DELETE FROM Addresses            WHERE AddressID = "+r.params.id;RunQuery(u,function(e){s.redirect("/usr/"+r.user.Username+"/addresses/")})}),router.route("/:username/addresses/add").get(isLoggedIn,function(e,r){r.render("profile/addAddress",{title:e.user.FullName,customer:e.user})}).post(isLoggedIn,function(r,s){var e=r.body,u="                INSERT INTO Addresses                VALUES (null, "+r.user.UserID+",                     '"+e.fullName+"',                     '"+e.streetAddress+"',                     '"+e.postcode+"',                     '"+e.city+"',                     '"+e.country+"',                     '"+e.phone+"')";RunQuery(u,function(e){s.redirect("/usr/"+r.user.Username+"/addresses/")})}),router.route("/:username/addresses/:id/ll").get(isLoggedIn,function(e,r){}),module.exports=router;
//# sourceMappingURL=profile.min.js.map
