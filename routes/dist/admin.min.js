"use strict";var express=require("express"),router=express.Router(),slug=require("slug"),database=require("../config/database"),RunQuery=database.RunQuery;function isAdmin(r,e,t){if(r.isAuthenticated()){if(1==r.user.Admin)return t();e.redirect("/usr/"+r.user.Username)}e.redirect("/")}router.route("/").get(isAdmin,function(r,e,t){e.redirect("/admin/cat")}),router.route("/cat").get(isAdmin,function(t,d,r){RunQuery("        SELECT *        FROM Categories",function(r){var e={title:"Admin - Categories",categories:r,customer:t.user};d.render("admin/categories",e)})}),router.route("/cat/:id/edit").get(isAdmin,function(t,d,r){var e="        SELECT *        FROM Categories        WHERE CategoryID = "+t.params.id;RunQuery(e,function(r){var e={title:"Admin - Edit Category",category:r[0],customer:t.user};d.render("admin/editCat",e)})}).post(isAdmin,function(r,e,t){var d="        UPDATE Categories        SET CategoryName = '"+r.body.name+"',             Description = '"+r.body.description+"',             CategorySlug = '"+slug(r.body.name)+"' WHERE CategoryID = "+r.params.id;RunQuery(d,function(r){e.redirect("/admin/cat")})}),router.route("/cat/:id/delete").post(isAdmin,function(r,e,t){sqlStr="            DELETE FROM Categories            WHERE CategoryID = "+r.params.id,RunQuery(sqlStr,function(r){e.redirect("/admin/cat")})}),router.route("/cat/add").get(isAdmin,function(r,e,t){var d={title:"Admin - Add Category",customer:r.user};e.render("admin/addCat",d)}).post(isAdmin,function(r,e,t){var d="        INSERT INTO Categories        VALUES (null, '"+r.body.name+"',             '"+r.body.description+"',             '"+slug(r.body.name)+"',             '"+slug(r.body.name)+".png')";RunQuery(d,function(r){e.redirect("/admin/cat")})}),router.route("/products").get(isAdmin,function(t,d,r){RunQuery("                    SELECT Products.*, Categories.CategoryName                    FROM Products                    INNER JOIN Categories                    ON Products.CategoryID = Categories.CategoryID",function(r){var e={title:"Admin - Products",products:r,customer:t.user};d.render("admin/products",e)})}),router.route("/products/:id/edit").get(isAdmin,function(d,o,r){var e="                    SELECT Products.*, Categories.CategoryName                    FROM Products                    INNER JOIN Categories                    ON Products.CategoryID = Categories.CategoryID                    WHERE ProductID = "+d.params.id;RunQuery(e,function(t){RunQuery(e="                SELECT *                FROM Categories",function(r){var e={title:"Admin - Edit Product",product:t[0],categories:r,customer:d.user};o.render("admin/editProduct",e)})})}).post(isAdmin,function(r,e,t){var d="        UPDATE Products        SET ProductName = '"+r.body.name+"',             CategoryID = "+r.body.category+",             ProductPrice = "+r.body.price+",             UnitsInStock = "+r.body.unit+",             Description = '"+r.body.description+"',             ManufactureYear = "+r.body.year+",             ProductSlug = '"+slug(r.body.name)+"', Feature = "+r.body.feature+"         WHERE ProductID = "+r.params.id;RunQuery(d,function(r){e.redirect("/admin/products")})}),router.route("/products/:id/delete").post(isAdmin,function(r,e,t){var d="            DELETE FROM Products            WHERE ProductID = "+r.params.id;RunQuery(d,function(r){e.redirect("/admin/products")})}),router.route("/products/add").get(isAdmin,function(t,d,r){RunQuery("            SELECT *            FROM Categories",function(r){var e={title:"Admin - Add Product",categories:r,customer:t.user};d.render("admin/addProduct",e)})}).post(isAdmin,function(r,e,t){var d="            INSERT INTO Products            VALUES (null, '"+r.body.name+"', "+r.body.category+", "+r.body.price+", "+r.body.unit+",             '"+r.body.description+"', "+r.body.year+",             '"+slug(r.body.name)+".png',             '"+slug(r.body.name)+"', "+r.body.feature+")";RunQuery(d,function(r){e.redirect("/admin/products")})}),router.route("/orders").get(isAdmin,function(t,d){RunQuery("            SELECT *            FROM Orders",function(r){var e={title:"Admin - Orders",customer:t.user,orders:r};d.render("admin/orders",e)})}),router.route("/orders/:id").get(isAdmin,function(u,i){var r="            SELECT *            FROM Orders            WHERE OrderID = "+u.params.id;RunQuery(r,function(o){r="            SELECT *            FROM Users            WHERE UserID = "+o[0].UserID,RunQuery(r,function(d){r="                SELECT *                FROM Addresses                WHERE AddressID = "+o[0].AddressID,RunQuery(r,function(t){r="                    SELECT *                    FROM `Order Details`                    INNER JOIN (                        SELECT Products.*, Categories.CategorySlug                        FROM Products                        INNER JOIN Categories                        ON Products.CategoryID = Categories.CategoryID                    ) `Table`                    ON `Order Details`.ProductID = `Table`.ProductID                    WHERE OrderID = "+o[0].OrderID,RunQuery(r,function(r){var e={title:"Admin - Orders",customer:u.user,order:o[0],orderCustomer:d[0],address:t[0],products:r};i.render("admin/viewOrder",e)})})})})}),router.route("/orders/:id/update").get(isAdmin,function(o,u,r){var e="            SELECT *            FROM Orders            WHERE OrderID = "+o.params.id;RunQuery(e,function(d){e="                SELECT *                FROM Addresses                WHERE AddressID = "+d[0].AddressID,RunQuery(e,function(t){e="                    SELECT *                    FROM `Order Details`                    INNER JOIN (                        SELECT Products.*, Categories.CategorySlug                        FROM Products                        INNER JOIN Categories                        ON Products.CategoryID = Categories.CategoryID                    ) `Table`                    ON `Order Details`.ProductID = `Table`.ProductID                    WHERE OrderID = "+d[0].OrderID,RunQuery(e,function(r){var e={title:"Admin - Update Status Order "+o.params.id,customer:o.user,order:d[0],address:t[0],products:r};u.render("admin/updateOrder",e)})})})}).post(isAdmin,function(r,e,t){var d="        UPDATE Orders        SET Status = '"+r.body.status+"'         WHERE OrderID = "+r.params.id;RunQuery(d,function(r){e.redirect("/admin/orders")})}),router.route("/customers").get(isAdmin,function(t,d){RunQuery("            SELECT *            FROM Users",function(r){var e={title:"Admin - Customers",customer:t.user,customers:r};d.render("admin/customers",e)})}),router.route("/customers/:id/makeAdmin").post(isAdmin,function(r,e){var t="            UPDATE Users            SET Admin = 1            WHERE UserID = "+r.params.id;RunQuery(t,function(r){e.redirect("/admin/customers/")})}),router.route("/customers/:id/removeAdmin").post(isAdmin,function(r,e){var t="            UPDATE Users            SET Admin = 0            WHERE UserID = "+r.params.id;RunQuery(t,function(r){e.redirect("/admin/customers/")})}),router.route("/customers/:id/delete").post(isAdmin,function(r,e){var t="            DELETE FROM Users            WHERE UserID = "+r.params.id;RunQuery(t,function(r){e.redirect("/admin/customers/")})}),module.exports=router;
//# sourceMappingURL=admin.min.js.map
