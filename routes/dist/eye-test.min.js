"use strict";var express=require("express"),router=express.Router(),LocalStrategy=require("passport-local").Strategy,bcrypt=require("bcrypt-nodejs"),database=require("../config/database"),RunQuery=database.RunQuery;module.exports=function(e){e.serializeUser(function(e,r){r(null,e.UserID)}),e.use("eye-test",new LocalStrategy({usernameField:"username",passwordField:"password",passReqToCallback:!0},function(d,i,y,c){var p=d.body.email;if(y!=d.body.rePassword)return c(null,!1,d.flash("signUpError","Passwords do not match."));var r="SELECT *                    FROM user1                    WHERE email = '"+p+"'";RunQuery(r,function(e){if(0<e.length)return c(null,!1,d.flash("signUpError","Email address has already been used."));RunQuery(r="                        SELECT *                        FROM user1                        WHERE username = '"+i+"'",function(e){if(0<e.length)return c(null,!1,d.flash("signUpError","Username has already been used."));var s=d.body.fullName,n=d.body.phone,u=d.body.streetAddress,a=d.body.postcode,t=d.body.city,o=d.body.country,r=bcrypt.hashSync(y,null,null),l="INSERT INTO user1                                    VALUES(null,                                    '"+s+"',                                     '"+u+"',                                     '"+a+"',                                     '"+t+"',                                     '"+o+"',                                     '"+n+"',                                     '"+p+"',                                     '"+i+"',                                     '"+r+"', 0)";RunQuery(l,function(e){var r={UserID:e.insertId};l="INSERT INTO Addresses                                    VALUES(null, "+e.insertId+", '"+s+"', '"+u+"', '"+a+"', '"+t+"', '"+o+"', '"+n+"')",RunQuery(l,function(e){return c(null,r)})})})})}))},module.exports=router;
//# sourceMappingURL=eye-test.min.js.map
